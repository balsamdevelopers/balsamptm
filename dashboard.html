<!DOCTYPE html>
<html>
<head>
    <title>PTM Teacher Dashboard</title>
    <style>
        body { font-family: Arial; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .controls { margin-bottom: 20px; }
        select { padding: 10px; font-size: 16px; width: 200px; }
        .time-slot { padding: 15px; border: 1px solid #ddd; margin: 10px 0; border-radius: 5px; }
        .current { background: #d4edda; border-color: #c3e6cb; }
        .next { background: #fff3cd; border-color: #ffeaa7; }
        .completed { background: #f8f9fa; color: #6c757d; }
    </style>
</head>
<body>
    <div class="container">
        <h2>PTM Teacher Dashboard</h2>
        <div class="controls">
            <label>Select Class & Section:</label>
            <select id="classSelect">
                <option value="5A">5A</option>
                <option value="5B">5B</option>
                <option value="6A">6A</option>
                <option value="6B">6B</option>
            </select>
        </div>
        <div id="schedule">
            <div class="time-slot current">
                <strong>9:00 AM</strong> - John Doe (5A)
            </div>
            <div class="time-slot next">
                <strong>9:10 AM</strong> - Jane Smith (5A)
            </div>
            <div class="time-slot">
                <strong>9:20 AM</strong> - Raj Kumar (5A)
            </div>
        </div>
    </div>

<script>
    const API_URL = "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec";

    async function loadSchedule() {
        const classSection = document.getElementById('classSelect').value;
        
        try {
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'getSchedule',
                    classSection: classSection
                })
            });
            
            const schedule = await response.json();
            displaySchedule(schedule);
            
        } catch (error) {
            document.getElementById('schedule').innerHTML = 
                '<p>Error loading schedule. Please try again.</p>';
        }
    }

    function displaySchedule(schedule) {
        const scheduleDiv = document.getElementById('schedule');
        
        if (schedule.length === 0) {
            scheduleDiv.innerHTML = '<p>No bookings for this class yet.</p>';
            return;
        }
        
        let html = '';
        const now = new Date();
        const currentTime = now.getHours() * 60 + now.getMinutes();
        let foundCurrent = false;
        
        schedule.forEach(slot => {
            const slotTime = slot.timeSlot.split(':');
            const slotMinutes = parseInt(slotTime[0]) * 60 + parseInt(slotTime[1]);
            
            let statusClass = '';
            
            if (!foundCurrent && slotMinutes <= currentTime && currentTime < slotMinutes + 10) {
                statusClass = 'current';
                foundCurrent = true;
            } else if (!foundCurrent && slotMinutes > currentTime) {
                statusClass = 'next';
                foundCurrent = true;
            } else if (slotMinutes + 10 <= currentTime) {
                statusClass = 'completed';
            }
            
            html += `
                <div class="time-slot ${statusClass}">
                    <strong>${slot.displaySlot}</strong> - ${slot.studentName} (${slot.classSection})
                </div>
            `;
        });
        
        scheduleDiv.innerHTML = html;
    }

    // Load schedule when class selection changes
    document.getElementById('classSelect').addEventListener('change', loadSchedule);
    
    // Load initial schedule
    loadSchedule();
    
    // Auto-refresh every 30 seconds
    setInterval(loadSchedule, 30000);
</script>
</body>
</html>
